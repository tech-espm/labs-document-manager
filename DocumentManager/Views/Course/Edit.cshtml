@model Course
@{
	ViewBag.Title = (Model == null ? "Criar Curso" : "Editar Curso");
}

<div class="modal fade" tabindex="-1" role="dialog" id="modalDelete">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Fechar"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Oops...</h4>
			</div>
			<div class="modal-body">
				<p class="no-margin-bottom">Tem certeza que deseja excluir o curso? Essa operação <b>NÃO</b> pode ser desfeita!</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" onclick="deleteItem(true)"><i class="fa fa-check"></i>Excluir</button>
				<button type="button" class="btn btn-outline btn-default" data-dismiss="modal"><i class="fa fa-times"></i>Cancelar</button>
			</div>
		</div>
	</div>
</div>

<form class="row" action="." method="post" id="form">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading clearfix">
				<div class="pull-left">
					Informações Básicas do Curso
				</div>
				@if (Model != null && ViewBag.CourseDelete == true) {
					<div class="pull-right">
						<button type="button" class="btn btn-outline btn-danger btn-xs" onclick="deleteItem(false)"><i class="fa fa-times"></i>Excluir</button>
					</div>
				}
			</div>
			<div class="panel-body no-bottom">
				@if (Model != null) {
					<div class="form-group text-right">
						<span class="label label-default">Id @Model.Id</span>
					</div>
				}
				<div class="form-group">
					<label for="name">Nome</label>
					<input id="name" name="name" maxlength="64" class="form-control upper" type="text" value="@(Model == null ? "" : Model.Name)" />
				</div>
				<div class="form-group">
					<label for="shortName">Apelido</label>
					<input id="shortName" name="shortName" maxlength="16" class="form-control upper" type="text" spellcheck="false" value="@(Model == null ? "" : Model.ShortName)" />
				</div>
			</div>
			<div class="panel-footer">
				<input value="@(Model == null ? "Criar Curso" : "Salvar Alterações")" class="btn btn-primary btn-lg btn-block" type="submit" />
			</div>
		</div>
	</div>
</form>

@section Scripts {
	<script type="text/javascript">
		//<![CDATA[
		"use strict";

		function deleteItem(confirmed) {
			if (JsonWebApi.active)
				return;

			Notification.hide();

			if (!confirmed) {
				$("#modalDelete").modal({
					backdrop: true,
					keyboard: true
				});
			} else {
				$("#modalDelete").modal("hide");

				Notification.wait();

				JsonWebApi.get("@Url.Action("Delete")", function (response) {
					if (response.success)
						window.location.href = "@Url.Action("Manage")";
					else
						Notification.error(response.value, true);
				}, "id", "@(Model == null ? 0 : Model.Id)");
			}
		}

		$("#form").validate({
			rules: {
				name: {
					maxlength: 64,
					required: true
				},
				shortName: {
					maxlength: 16,
					required: true
				}
			},
			submitHandler: function (form) {
				if (JsonWebApi.active)
					return;

				var name = _("name").value, shortName = _("shortName").value;

				Notification.wait();

				@if (Model == null) {
					<text>
					JsonWebApi.post("@Url.Action("Create")", null, function (response) {
						if (response.success) {
							resetForm(form);
							Notification.success("Curso criado com sucesso! \uD83D\uDE04");
						} else {
							Notification.error(response.value, true);
						}
					}, "name", name, "shortName", shortName);
					</text>
				} else {
					<text>
					JsonWebApi.post("@Url.Action("Update")", null, function (response) {
						if (response.success)
							Notification.success("Curso alterado com sucesso! \uD83D\uDE04");
						else
							Notification.error(response.value, true);
					}, "id", "@Model.Id", "name", name, "shortName", shortName);
					</text>
				}
			}
		});

		//]]>
	</script>
}
